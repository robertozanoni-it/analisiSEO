<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Specialist Audit Tool – Professional Edition v5.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617;
            --panel: #0f172a;
            --card: #1e293b;
            --primary: #818cf8;
            --primary-glow: rgba(129, 140, 248, 0.2);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #38bdf8;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            background-image: radial-gradient(circle at 0% 0%, #1e1b4b 0%, transparent 40%);
            min-height: 100vh;
        }

        .container { max-width: 1500px; margin: 0 auto; }

        header {
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand h1 { font-size: 1.6rem; font-weight: 800; letter-spacing: -0.05em; margin: 0; background: linear-gradient(to right, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            background: rgba(15, 23, 42, 0.6);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            cursor: pointer;
        }
        .upload-zone:hover { border-color: var(--primary); background: var(--primary-glow); }

        textarea { width: 100%; height: 80px; background: var(--panel); border: 1px solid var(--border); color: #cbd5e1; padding: 1rem; font-family: 'Fira Code', monospace; border-radius: 12px; margin-bottom: 1rem; outline: none; resize: none; font-size: 0.8rem; }

        .toolbar { display: flex; gap: 8px; margin-bottom: 2rem; flex-wrap: wrap; }
        button { padding: 10px 14px; border-radius: 8px; font-weight: 700; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; font-size: 10px; text-transform: uppercase; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-outline:hover { color: #fff; border-color: var(--primary); background: rgba(255,255,255,0.05); }
        .btn-danger { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); color: var(--danger); }
        .btn-danger:hover { background: var(--danger); color: #fff; }

        .filter-bar { display: flex; gap: 10px; margin-bottom: 1.5rem; padding: 1rem; background: rgba(15, 23, 42, 0.4); border-radius: 12px; border: 1px solid var(--border); align-items: center; }
        .filter-label { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-right: 5px; }
        .filter-btn { padding: 6px 12px; border-radius: 6px; font-size: 0.65rem; border: 1px solid var(--border); background: var(--card); color: var(--text-muted); cursor: pointer; transition: 0.2s; }
        .filter-btn.active[data-filter="all"] { background: var(--primary); color: white; border-color: var(--primary); }
        .filter-btn.active[data-filter="pass"] { background: var(--success); color: white; border-color: var(--success); }
        .filter-btn.active[data-filter="warning"] { background: var(--warning); color: white; border-color: var(--warning); }
        .filter-btn.active[data-filter="fail"] { background: var(--danger); color: white; border-color: var(--danger); }
        .filter-btn.active[data-filter="info"] { background: var(--info); color: white; border-color: var(--info); }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: var(--panel); padding: 1.2rem; border-radius: 12px; border: 1px solid var(--border); position: relative; overflow: hidden; }
        .stat-val { font-size: 1.6rem; font-weight: 800; color: #fff; display: block; }
        .stat-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        .view { display: none; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        section { margin-bottom: 2.5rem; }
        h2 { font-size: 0.9rem; color: #fff; margin-bottom: 1.2rem; display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 0.1em;}
        h2::before { content: ""; width: 4px; height: 18px; background: var(--primary); border-radius: 2px; }

        .checklist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 1.2rem; }
        .check-card { background: var(--panel); border: 1px solid var(--border); padding: 1.2rem; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; transition: all 0.3s; position: relative; }
        .check-card:hover { transform: translateY(-4px); border-color: var(--primary); }
        .check-card.hidden { display: none; }
        
        .card-header { display: flex; align-items: flex-start; gap: 14px; }
        .check-info h4 { margin: 0; color: #f8fafc; font-size: 0.9rem; line-height: 1.2; margin-bottom: 4px; }
        .check-info p { margin: 0; color: var(--text-muted); font-size: 0.75rem; line-height: 1.4; }

        .action-box { margin-top: 8px; padding: 10px; background: rgba(2, 6, 23, 0.5); border-left: 3px solid var(--primary); border-radius: 4px; }
        .action-box strong { display: block; font-size: 0.65rem; text-transform: uppercase; color: var(--primary); margin-bottom: 4px; letter-spacing: 0.05em; }
        .action-box span { font-size: 0.72rem; color: #cbd5e1; line-height: 1.4; display: block; }

        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.6rem; font-weight: 800; flex-shrink: 0; text-align: center; min-width: 65px; border: 1px solid transparent;}
        .pass { background: rgba(34, 197, 94, 0.1); color: var(--success); border-color: rgba(34, 197, 94, 0.3); }
        .fail { background: rgba(239, 68, 68, 0.1); color: var(--danger); border-color: rgba(239, 68, 68, 0.3); }
        .warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); border-color: rgba(245, 158, 11, 0.3); }
        .info { background: rgba(56, 189, 248, 0.1); color: var(--info); border-color: rgba(56, 189, 248, 0.3); }

        .code-block { background: #020617; padding: 16px; border-radius: 12px; font-family: 'Fira Code', monospace; font-size: 0.75rem; color: #a5b4fc; border: 1px solid var(--border); overflow-x: auto; white-space: pre-wrap; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="brand">
            <h1>WP SEO Auditor <small style="font-size: 0.5em; color: var(--primary); opacity: 0.8;">Expert Suite v5.0</small></h1>
        </div>
        <div style="font-size: 0.7rem; color: var(--text-muted);">
            Progettato per: Web Designers & SEO Specialists
        </div>
    </header>

    <div id="dropZone" class="upload-zone" onclick="document.getElementById('fileInput').click()">
        <p><b>Trascina il sorgente HTML</b> o clicca per caricare un file</p>
        <input type="file" id="fileInput" accept=".html,.htm" style="display:none">
    </div>

    <textarea id="htmlInput" placeholder="Incolla il codice HTML (CTRL+U del sito)..."></textarea>
    
    <div class="toolbar">
        <button id="btnAudit" class="btn-primary">ESEGUI AUDIT TOTALE</button>
        <button class="btn-outline" onclick="switchView('dashboard')">RECAP DASHBOARD</button>
        <button class="btn-outline" onclick="switchView('wp-pro')">WP CHECKLIST PRO (50 PUNTI)</button>
        <button class="btn-outline" onclick="switchView('seo')">ARCHITETTURA & TAG</button>
        <button class="btn-outline" onclick="switchView('links')">MEDIA & LINK</button>
        <button class="btn-danger" style="margin-left: auto;" onclick="resetTest()">PULISCI / NUOVO TEST</button>
    </div>

    <div id="statsRow" class="stats-grid" style="display:none;">
        <div class="stat-card"><span class="stat-val" id="st-tags">0</span><span class="stat-label">Elementi DOM</span></div>
        <div class="stat-card"><span class="stat-val" id="st-lang">-</span><span class="stat-label">Lingua Rilevata</span></div>
        <div class="stat-card"><span class="stat-val" id="st-cms">-</span><span class="stat-label">Core Engine</span></div>
        <div class="stat-card"><span class="stat-val" id="st-health">-%</span><span class="stat-label">SEO Health Score</span></div>
    </div>

    <div id="dashboardView" class="view">
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
            <section>
                <h2>Snippet Preview (Meta)</h2>
                <div id="metaBox" class="code-block"></div>
            </section>
            <section>
                <h2>Infrastruttura Server & Crawler</h2>
                <div id="serverBox" class="code-block"></div>
            </section>
        </div>
    </div>

    <div id="wp-proView" class="view">
        <section>
            <h2>WP Professional Setup & Advanced Strategy (Full 50 Points)</h2>
            
            <div class="filter-bar">
                <span class="filter-label">Filtra Risultati:</span>
                <button class="filter-btn active" data-filter="all">TUTTI</button>
                <button class="filter-btn" data-filter="pass">PASS</button>
                <button class="filter-btn" data-filter="fail">FAIL</button>
                <button class="filter-btn" data-filter="warning">WARNING</button>
                <button class="filter-btn" data-filter="info">INFO</button>
            </div>

            <div id="wpProChecklist" class="checklist-grid"></div>
        </section>
    </div>

    <div id="seoView" class="view">
        <section>
            <h2>Gerarchia Intestazioni (H1-H6)</h2>
            <div id="headingTree" class="code-block"></div>
        </section>
    </div>

    <div id="linksView" class="view">
        <section>
            <h2>Tabella Link (Interni vs Esterni)</h2>
            <div class="data-table-container">
                <table class="data-table" id="linkTable">
                    <thead><tr><th>Testo Ancora</th><th>URL</th><th>Stato</th><th>Rel</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </div>
</div>

<script>
    window.switchView = function(v) {
        document.querySelectorAll('.view').forEach(view => view.style.display = 'none');
        const target = document.getElementById(v + 'View');
        if (target) target.style.display = 'block';
    };

    window.resetTest = function() {
        document.getElementById('htmlInput').value = '';
        document.getElementById('statsRow').style.display = 'none';
        document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
    };

    function filterChecklist(status) {
        const cards = document.querySelectorAll('.check-card');
        const buttons = document.querySelectorAll('.filter-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        const activeBtn = document.querySelector(`.filter-btn[data-filter="${status}"]`);
        if (activeBtn) activeBtn.classList.add('active');

        cards.forEach(card => {
            if (status === 'all' || card.getAttribute('data-status') === status) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    }

    window.runFullAudit = function() {
        const source = document.getElementById('htmlInput').value.trim();
        if (!source) return;

        const parser = new DOMParser();
        const doc = parser.parseFromString(source, 'text/html');
        document.getElementById('statsRow').style.display = 'grid';

        const isWP = source.includes('wp-content') || source.includes('wp-includes');
        const isElementor = source.includes('elementor-') || !!doc.querySelector('.elementor');
        const isHTTPS = source.includes('https://');
        const hasHreflang = !!doc.querySelector('link[hreflang]');
        const hasBreadcrumb = source.includes('breadcrumb') || source.includes('schema.org/BreadcrumbList');
        const hasGTM = source.includes('googletagmanager.com/gtm.js');
        const hasFAQ = source.includes('FAQPage') || source.includes('wp-block-yoast-faq') || source.includes('rank-math-faq');
        const isRankMath = source.includes('rank-math');
        const isYoast = source.includes('yoast');
        const isGutenberg = source.includes('wp-block-') || source.includes('<!-- wp:');

        document.getElementById('st-tags').innerText = doc.getElementsByTagName('*').length;
        document.getElementById('st-lang').innerText = (doc.documentElement.lang || "it-IT").toUpperCase();
        document.getElementById('st-cms').innerText = isWP ? (isElementor ? "WP + Elementor" : "WP Native") : "Custom";

        // Definizione punti con SUGGERIMENTI e RISOLUZIONI
        const points = [
            { t: "Hosting & HTTPS", s: isHTTPS ? 'pass' : 'fail', d: "Usa protocollo sicuro e hosting veloce.", r: "Installa un certificato SSL (Let's Encrypt) e attiva il force HTTPS nel file .htaccess o tramite plugin 'Really Simple SSL'." },
            { t: "Redirect 301", s: 'info', d: "Gestione migrazioni URL.", r: "Usa il modulo Redirections di Rank Math per mappare i vecchi URL e prevenire errori 404 che danneggiano il posizionamento." },
            { t: "Lingua HTML", s: doc.documentElement.lang ? 'pass' : 'fail', d: "Attributo lang nel tag html.", r: "Vai in Impostazioni > Generale e imposta correttamente la 'Lingua del sito'. Se multilingua, usa WPML o Polylang." },
            { t: "Pulizia Plugin", s: 'warning', d: "Plugin inattivi o inutilizzati.", r: "Disinstalla i plugin non necessari. Ogni plugin attivo aggiunge query al DB e script JS/CSS che rallentano il caricamento." },
            { t: "Menu & Navigazione", s: 'pass', d: "Accessibilità e gerarchia.", r: "Verifica che il menu principale rifletta la struttura a Silo del sito per distribuire correttamente la link juice." },
            { t: "Breadcrumb SEO", s: hasBreadcrumb ? 'pass' : 'warning', d: "Percorsi di navigazione.", r: "Abilita le Breadcrumb in Rank Math > Impostazioni Generali e inserisci lo shortcode nel template header di Elementor." },
            { t: "Pagina 404 Custom", s: 'info', d: "Gestione errori di navigazione.", r: "Crea un template 404 con Elementor Pro che includa una barra di ricerca e link alle categorie principali per ridurre il bounce rate." },
            { t: "Paginazione Rel Prev/Next", s: 'info', d: "Indicizzazione archivi.", r: "Verifica che il tuo tema supporti i tag rel=next/prev. Rank Math li aggiunge automaticamente alle pagine di archivio." },
            { t: "Nofollow Link Esterni", s: 'info', d: "Controllo autorità in uscita.", r: "Per link affiliati o non autorevoli, attiva l'opzione 'Aggiungi rel=nofollow' nelle impostazioni del link di Elementor o Gutenberg." },
            { t: "Upload Media Ottimizzati", s: 'info', d: "Compressione immagini.", r: "Installa 'Imagify' o 'Smush' per comprimere le immagini al caricamento e convertirle in formato WebP." },
            { t: "Blocco Noindex Staging", s: source.includes('noindex') ? 'warning' : 'pass', d: "Visibilità ai motori di ricerca.", r: "Se il sito è live e vedi 'warning', vai in Impostazioni > Lettura e togli la spunta a 'Scoraggia i motori di ricerca'." },
            { t: "Database Cleanup", s: 'info', d: "Ottimizzazione performance DB.", r: "Usa 'WP-Optimize' per eliminare revisioni dei post vecchie e pulire i metadati orfani che appesantiscono le query." },
            { t: "Feed RSS & Estratti", s: 'info', d: "Protezione contenuti feed.", r: "In Impostazioni > Lettura, imposta 'Per ogni articolo nel feed, includi: Riassunto' per evitare lo scraping totale dei contenuti." },
            { t: "Ricerca Interna", s: doc.querySelector('form[role="search"]') ? 'pass' : 'warning', d: "User experience di ricerca.", r: "Se usi Elementor, usa il widget 'Search Form'. Assicurati che la pagina dei risultati sia indicizzabile se pertinente." },
            { t: "Breadcrumb Schema", s: hasBreadcrumb ? 'pass' : 'fail', d: "Dati strutturati per i percorsi.", r: "Verifica con lo strumento 'Test dei risultati multimediali' di Google se lo Schema BreadcrumbList è valido." },
            { t: "PHP Version (8.1+)", s: 'info', d: "Aggiornamento ambiente server.", r: "Chiedi al tuo hosting di switchare a PHP 8.1 o 8.2. Questo può aumentare la velocità di esecuzione di WordPress del 20%." },
            { t: "Privacy & GDPR", s: source.includes('cookie') ? 'pass' : 'fail', d: "Conformità legale.", r: "Usa Iubenda o Complianz. Assicurati che il blocco preventivo dei cookie funzioni correttamente prima del consenso." },
            { t: "Tracking GTM/GA4", s: hasGTM ? 'pass' : 'warning', d: "Analisi dati e conversioni.", r: "Inserisci lo script GTM nell'header tramite 'Custom Code' di Elementor o plugin come 'GTM4WP' per tracciamenti E-commerce avanzati." },
            { t: "Mobile Friendly", s: source.includes('viewport') ? 'pass' : 'fail', d: "Ottimizzazione per smartphone.", r: "Usa le modalità responsive di Elementor per aggiustare padding e font-size specifici per mobile (fondamentale per Google)." },
            { t: "Audit Periodico", s: 'info', d: "Manutenzione SEO costante.", r: "Esporta questo report mensilmente e confrontalo con i dati di Google Search Console per identificare cali di impression." },
            { t: "Struttura URL Cat/Tag", s: 'info', d: "Pulizia permalink.", r: "In Rank Math > Impostazioni Generali > Link, attiva 'Rimuovi base categoria' per ottenere URL più brevi e puliti." },
            { t: "Slug Multilingua", s: hasHreflang ? 'pass' : 'info', d: "Traduzione degli URL.", r: "Se usi WPML, assicurati che ogni slug sia tradotto nella lingua di destinazione per migliorare la rilevanza locale." },
            { t: "Hreflang Tags", s: hasHreflang ? 'pass' : 'warning', d: "Targetizzazione geografica.", r: "Verifica nel sorgente che siano presenti i tag <link rel='alternate' hreflang='...'> per evitare problemi di contenuti duplicati." },
            { t: "Ruoli Utente SEO", s: 'info', d: "Sicurezza editoriale.", r: "Limita l'accesso alle impostazioni SEO solo ai ruoli 'SEO Manager' utilizzando il Role Manager di Rank Math." },
            { t: "Linee Guida Editoriali", s: 'info', d: "Standardizzazione contenuti.", r: "Crea un 'Manuale di Stile' che imponga l'uso di H2/H3 ogni 300 parole e l'uso del grassetto sulle keyword principali." },
            { t: "Duplicate Content", s: 'info', d: "Gestione tag canonical.", r: "Controlla che Rank Math inserisca automaticamente il tag rel=canonical che punta all'URL principale della pagina." },
            { t: "Gestione Thin Content", s: 'warning', d: "Pagine con scarso valore.", r: "Identifica le pagine con meno di 200 parole. O le arricchisci con contenuto utile o le imposti su 'noindex' via SEO meta box." },
            { t: "Pagine Chi Siamo/Contatti", s: 'pass', d: "Segnali di fiducia E-E-A-T.", r: "Assicurati che queste pagine siano facilmente raggiungibili dal footer. Includi indirizzo fisico e P.IVA per massimizzare il Trust." },
            { t: "FAQ Schema Blocks", s: hasFAQ ? 'pass' : 'warning', d: "Rich Snippets nei risultati.", r: "Usa il widget 'Accordion' di Elementor attivando lo schema FAQ o usa il blocco FAQ di Rank Math in Gutenberg." },
            { t: "Blocchi Riutilizzabili", s: isGutenberg ? 'pass' : 'info', d: "Efficienza produttiva.", r: "Sfrutta i 'Gutenberg Reusable Blocks' o i 'Template Salvati' di Elementor per inserire CTA SEO-friendly in tutto il sito." },
            { t: "Landing Page PPC/SEO", s: isElementor ? 'pass' : 'info', d: "Conversion Rate Optimization.", r: "Crea layout specifici senza distrazioni (no menu) per le campagne ADS, mantenendo però la coerenza SEO." },
            { t: "Gutenberg Compatibility", s: isGutenberg ? 'pass' : 'info', d: "Modernizzazione editor.", r: "Usa Gutenberg per i post del blog per mantenere il codice pulito e leggero, riservando Elementor alle pagine statiche." },
            { t: "Widget Sidebar/Footer", s: 'info', d: "Link interni strutturali.", r: "Usa i widget per mostrare 'Articoli Correlati' o 'Post Più Letti' per aumentare il tempo di permanenza sul sito." },
            { t: "Riduzione Script", s: 'warning', d: "Ottimizzazione caricamento.", r: "Usa 'Asset CleanUp' per disabilitare il caricamento di Contact Form 7 o altri script nelle pagine dove non sono presenti form." },
            { t: "Configurazione CDN", s: 'info', d: "Distribuzione globale asset.", r: "Collega il sito a Cloudflare (gratuito) per servire immagini e script da server vicini all'utente, migliorando l'LCP." },
            { t: "Staging/Production Split", s: 'info', d: "Sicurezza dello sviluppo.", r: "Non testare modifiche SEO pesanti sul sito live. Usa un ambiente di staging (es. LocalWP o sottodominio)." },
            { t: "Naming Convention Layout", s: 'info', d: "Organizzazione interna.", r: "Rinomina i template di Elementor in modo logico (es. 'Header - Main Site') per facilitare la manutenzione futura." },
            { t: "Custom Post Types (CPT)", s: 'info', d: "Strutturazione dati complessi.", r: "Se gestisci 'Servizi' o 'Portfolio', usa i CPT per separare i contenuti dal blog e avere una struttura URL dedicata." },
            { t: "Tassonomie CPT", s: 'info', d: "Organizzazione archivi CPT.", r: "Crea categorie personalizzate per i tuoi CPT per aiutare i crawler a capire la pertinenza dei contenuti." },
            { t: "Membership/LMS SEO", s: 'info', d: "SEO per aree protette.", r: "Se vendi corsi, rendi i titoli delle lezioni e le descrizioni brevi pubbliche per attirare traffico organico." },
            { t: "Gestione Redirect Migrazioni", s: 'info', d: "Preservazione ranking.", r: "Prima di cambiare dominio o struttura URL, prepara un file CSV con tutti i vecchi e nuovi URL per l'importazione in Rank Math." },
            { t: "Editor Performance", s: isElementor ? 'warning' : 'pass', d: "Velocità dell'interfaccia.", r: "Se Elementor è lento, aumenta il 'Memory Limit' di WordPress a 512M nel file wp-config.php." },
            { t: "Conditional Loading", s: 'info', d: "Caricamento asset dinamico.", r: "Attiva in Elementor > Impostazioni > Esperimenti 'Improved Asset Loading' per caricare solo il CSS necessario." },
            { t: "Errori PHP & Log", s: 'info', d: "Diagnostica invisibile.", r: "Controlla il file wp-content/debug.log per vedere se ci sono plugin che generano 'Notice' o 'Warning' che rallentano il server." },
            { t: "Contenuti Obsoleti", s: 'info', d: "Content Decay management.", r: "Usa 'Google Search Console' per trovare pagine che hanno perso clic e aggiorna il contenuto con nuove informazioni ogni 6 mesi." },
            { t: "Core Web Vitals Test", s: 'warning', d: "Metriche di velocità reali.", r: "Ottimizza il 'Cumulative Layout Shift' impostando dimensioni fisse per le immagini e riservando spazio per i banner pubblicitari." },
            { t: "Commenti Paginati", s: 'warning', d: "Evitare contenuti duplicati.", r: "In Impostazioni > Discussione, disabilita 'Suddividi i commenti in pagine' per evitare che lo stesso articolo appaia su più URL." },
            { t: "Newsletter Form", s: 'info', d: "Lead generation non invasiva.", r: "Usa popup 'Exit Intent' invece di quelli immediati per non disturbare la lettura e peggiorare i segnali UX di Google." },
            { t: "Branding & Favicon", s: !!doc.querySelector('link[rel*="icon"]') ? 'pass' : 'fail', d: "Riconoscibilità nei tab.", r: "Carica il Site Icon in Aspetto > Personalizza > Denominazione del sito (dimensione consigliata 512x512px)." },
            { t: "Documentazione Checklist", s: 'info', d: "Reporting per il cliente.", r: "Salva i risultati di questo audit in un PDF da allegare alla fattura o al report mensile per dimostrare il valore del tuo lavoro SEO." }
        ];

        document.getElementById('wpProChecklist').innerHTML = points.map((p, i) => `
            <div class="check-card" data-status="${p.s}">
                <div class="card-header">
                    <div class="badge ${p.s}">${p.s.toUpperCase()}</div>
                    <div class="check-info">
                        <h4>${i + 1}. ${p.t}</h4>
                        <p>${p.d}</p>
                    </div>
                </div>
                ${p.s !== 'pass' ? `
                    <div class="action-box">
                        <strong>Azione Consigliata:</strong>
                        <span>${p.r}</span>
                    </div>
                ` : ''}
            </div>
        `).join('');

        // Recap Dashboard
        document.getElementById('metaBox').innerText = `TITLE: ${doc.title || "MANCANTE"}\nDESC: ${doc.querySelector('meta[name="description"]')?.content || "MANCANTE"}\nSEO PLUGIN: ${isRankMath ? 'Rank Math' : (isYoast ? 'Yoast' : 'Non rilevato')}`;
        document.getElementById('serverBox').innerText = `SERVER: ${isHTTPS ? 'HTTPS' : 'HTTP (Rischio)'}\nSITEMAP: ${source.includes('sitemap') ? 'Rilevata' : 'Non trovata'}\nCACHE: ${source.includes('wp-rocket') || source.includes('litespeed') ? 'Attiva' : 'Non rilevata'}`;

        const hs = Array.from(doc.querySelectorAll('h1, h2, h3, h4')).map(h => `${h.tagName}: ${h.innerText.trim()}`).join('\n');
        document.getElementById('headingTree').innerText = hs || "Nessun tag H trovato.";

        const links = Array.from(doc.querySelectorAll('a')).slice(0, 30).map(a => `
            <tr><td>${a.innerText.trim().slice(0,30) || '[Nessun testo]'}</td><td>${a.href.slice(0,50)}</td><td><span class="badge pass">LIVE</span></td><td>${a.rel || "-"}</td></tr>
        `).join('');
        document.querySelector('#linkTable tbody').innerHTML = links;

        window.switchView('wp-pro');
        filterChecklist('all'); // Reset filtri all'avvio
    };

    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('fileInput');
        const btnAudit = document.getElementById('btnAudit');
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => filterChecklist(btn.getAttribute('data-filter')));
        });

        if (fileInput) {
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('htmlInput').value = ev.target.result;
                    window.runFullAudit();
                };
                reader.readAsText(file);
            });
        }
        if (btnAudit) btnAudit.addEventListener('click', window.runFullAudit);
    });
</script>
</body>
</html>
